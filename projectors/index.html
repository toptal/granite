
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../testing/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Projectors - Granite Manual</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#projectors" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Granite Manual" class="md-header__button md-logo" aria-label="Granite Manual" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Granite Manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Projectors
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/toptal/granite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Granite Manual" class="md-nav__button md-logo" aria-label="Granite Manual" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    Granite Manual
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/toptal/granite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Projectors
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Projectors
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    <span class="md-ellipsis">
      Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i18n-projectors-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      I18n projectors lookup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decorator-part" class="md-nav__link">
    <span class="md-ellipsis">
      Decorator part
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-part" class="md-nav__link">
    <span class="md-ellipsis">
      Controller part
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Controller part">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizations" class="md-nav__link">
    <span class="md-ellipsis">
      Customizations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-policy-exception" class="md-nav__link">
    <span class="md-ellipsis">
      Handling policy exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-projectors" class="md-nav__link">
    <span class="md-ellipsis">
      Extending projectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views" class="md-nav__link">
    <span class="md-ellipsis">
      Views
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    <span class="md-ellipsis">
      Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i18n-projectors-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      I18n projectors lookup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decorator-part" class="md-nav__link">
    <span class="md-ellipsis">
      Decorator part
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller-part" class="md-nav__link">
    <span class="md-ellipsis">
      Controller part
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Controller part">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizations" class="md-nav__link">
    <span class="md-ellipsis">
      Customizations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-policy-exception" class="md-nav__link">
    <span class="md-ellipsis">
      Handling policy exception
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-projectors" class="md-nav__link">
    <span class="md-ellipsis">
      Extending projectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views" class="md-nav__link">
    <span class="md-ellipsis">
      Views
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="projectors">Projectors<a class="headerlink" href="#projectors" title="Permanent link">&para;</a></h1>
<p>If you need a simpler way to handle complex logic in your existing controller, you can use the Granite action by calling it in the controller action:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MoviesController</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">ApplicationController</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="c1"># Regular controller definition</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">create</span>
<span class="w">    </span><span class="no">BA</span><span class="o">::</span><span class="no">Movies</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="ss">performer</span><span class="p">:</span><span class="w"> </span><span class="n">current_user</span><span class="p">)</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">some_params</span><span class="p">)</span><span class="o">.</span><span class="n">perform!</span>
<span class="w">  </span><span class="k">end</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>However, this code can quickly become repetitive, so it's recommended to use projectors instead.</p>
<p>Projectors are mainly used to avoid duplicating code in controller actions and decorator methods. They enable business actions to be rendered into a user interface more easily.</p>
<h2 id="basics">Basics<a class="headerlink" href="#basics" title="Permanent link">&para;</a></h2>
<p>A projector file has two parts: </p>
<ol>
<li>
<p><strong>Decorator part</strong> is the projector class itself.</p>
</li>
<li>
<p><strong>Controller part</strong> is a nested class defined implicitly and accessible via <code>TestProjector.controller_class</code>.</p>
</li>
</ol>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestProjector</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Projector</span>
<span class="k">end</span>
</code></pre></div>
<p>To mount projectors into actions and routes, you can use the projector method. It's possible to mount multiple projectors onto one action (e.g., if we need to execute a business action through a standard confirmation dialog or inline editing) or to have one projector mounted by several actions:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Action</span>
<span class="w">  </span><span class="n">projector</span><span class="w"> </span><span class="ss">:test</span>

<span class="w">  </span><span class="c1"># Alternatively, you can specify a custom name:</span>
<span class="w">  </span><span class="c1"># projector :main, class_name: &#39;TestProjector&#39;</span>
<span class="k">end</span>
</code></pre></div>
<p>When a projector is mounted onto an action, an inherited projector and a controller class are created:</p>
<div class="highlight"><pre><span></span><code><span class="go">pry(main)&gt; Action.test</span>
<span class="go">=&gt; Action::TestProjector</span>

<span class="go">pry(main)&gt; Action.test.controller_class</span>
<span class="go">=&gt; Action::TestController</span>

<span class="go">pry(main)&gt; Action.test.action_class</span>
<span class="go">=&gt; Action(no attributes)</span>

<span class="go">pry(main)&gt; Action.test.controller_class.action_class</span>
<span class="go">=&gt; Action(no attributes)</span>
</code></pre></div>
<p>To mount projectors onto routes, you need to specify a path to the projector as a string. If a business action has multiple projectors, each of them must be mounted separately in the routes. If an action doesn't have a subject, it should be mounted explicitly inside the <code>collection</code> block:</p>
<p>When you call <code>granite</code> in the routes, every controller of every mounted projector for the specified action is taken, and its controller actions are mounted onto the routes. You can also mount specific projectors.</p>
<p>Projectors can only be mounted inside a resource, and they are mounted on <code>:member</code> if they have a <code>subject</code> and on <code>:collection</code> otherwise:</p>
<div class="highlight"><pre><span></span><code><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">resources</span><span class="w"> </span><span class="ss">:users</span><span class="p">,</span><span class="w"> </span><span class="ss">only</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="ss">:index</span><span class="o">]</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">collection</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="n">granite</span><span class="w"> </span><span class="s1">&#39;create#my_projector&#39;</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="n">granite</span><span class="w"> </span><span class="s1">&#39;remove#my_projector&#39;</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>When you mount a projector onto a route, the route will be defined by the resources block and the string provided. The Granite action and projector will be inferred by the parameter, which is split by the <code>#</code> character.</p>
<p>For instance, in the previous code block, the route <code>/users/create/:projector_action</code> is created, where the action is <code>Create</code> and the projector is <code>MyProjector</code>. </p>
<p>Next code block shows how the <code>:projector_action</code> refers to the projector controller action (<code>baz</code> and <code>bar</code>):</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FooProjector</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Projector</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="ss">:baz</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="ss">:bar</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">render</span><span class="w"> </span><span class="ss">json</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="ss">cats</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;nice&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Action</span>
<span class="w">  </span><span class="n">projector</span><span class="w"> </span><span class="ss">:foo</span>
<span class="k">end</span>

<span class="c1"># config/routes.rb</span>
<span class="c1"># ...</span>
<span class="n">resources</span><span class="w"> </span><span class="ss">:bunnies</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">granite</span><span class="w"> </span><span class="s1">&#39;action#foo&#39;</span>
<span class="k">end</span>
</code></pre></div>
<p>In this context, the route <code>/bunnies/action/bar</code> corresponds to the <code>bar</code> action in the <code>FooProjector</code>, and <code>/bunnies/action</code> leads to the <code>baz</code> action in the same <code>FooProjector</code>.</p>
<p>Usually, projectors are mounted under <code>/:action/:projector_action</code>, where <code>:action</code> is the name of the BA, and <code>:projector_action</code> is mapped to the projector controller action.</p>
<p>Please note that if you have multiple projectors for the same action, they might use the same routes. To avoid conflicts between projectors, it's recommended to mount the second projector with <code>projector_prefix: true</code>. This will mount the projector under <code>/:projector_:action/:projector_action</code> instead of <code>/:action/:projector_action</code>. The same goes for the path helper method, which will be <code>projector_action_subject_path</code> instead of <code>action_subject_path</code>.</p>
<p>You can also customize the mount path using <code>path: '/my_custom_path', as: :my_custom_action</code>.</p>
<p>It's also possible to restrict the HTTP verbs for actions using <code>via: :post</code> (or <code>:get</code>, or any valid HTTP-action).</p>
<p>Lastly, you can access the projector instance from the action instance using the projector name:</p>
<div class="highlight"><pre><span></span><code><span class="go">pry(main)&gt; Action.new.test</span>
<span class="go">=&gt; #&lt;Action::TestProjector:0x007f98bde9ac98 @action=#&lt;Action (no attributes)&gt;&gt;</span>

<span class="go">pry(main)&gt; Action.new.test.action</span>
<span class="go">=&gt; #&lt;Action (no attributes)&gt;</span>
</code></pre></div>
<h3 id="i18n-projectors-lookup">I18n projectors lookup<a class="headerlink" href="#i18n-projectors-lookup" title="Permanent link">&para;</a></h3>
<p>In Granite actions, there are special I18n rules that apply to projectors. When the I18n identifier is prefixed with a dot (<code>t('.foobar')</code>), translations are looked up in the following order:</p>
<div class="highlight"><pre><span></span><code>granite_action.ba/#{granite_action_name}.#{granite_projector_name}.#{view_name}.foobar
granite_action.ba/#{granite_action_name}.#{granite_projector_name}.foobar
granite_action.base_action.#{granite_projector_name}.#{view_name}.foobar
granite_action.base_action.#{granite_projector_name}.foobar
granite_action.granite/action.#{granite_projector_name}.#{view_name}.foobar
granite_action.granite/action.#{granite_projector_name}.foobar
#{granite_projector_name}.#{view_name}.foobar
#{granite_projector_name}.foobar
</code></pre></div>
<h2 id="decorator-part">Decorator part<a class="headerlink" href="#decorator-part" title="Permanent link">&para;</a></h2>
<p>Since projectors behave like decorators, you can define helpers at the projector instance level. For example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestProjector</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Projector</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">link</span>
<span class="w">    </span><span class="n">h</span><span class="o">.</span><span class="n">link_to</span><span class="w"> </span><span class="n">action</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">full_name</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="o">.</span><span class="n">subject</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Action</span>
<span class="w">  </span><span class="n">projector</span><span class="w"> </span><span class="ss">:test</span>
<span class="w">  </span><span class="n">subject</span><span class="w"> </span><span class="ss">:user</span>
<span class="k">end</span>
</code></pre></div>
<p>In your application, you can call this helper method like this:</p>
<div class="highlight"><pre><span></span><code><span class="no">Action</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">User</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">link</span>
<span class="c1"># =&gt; &quot;&lt;a href=\&quot;/user/112014\&quot;&gt;Sebastián López Alfonso&lt;/a&gt;&quot;</span>
</code></pre></div>
<p>This will generate a link to the <code>User</code> object's page with the user's full name as the link text. The <code>link</code> method is defined in the <code>TestProjector</code> and is called on the test projector instance that is associated with the <code>Action</code> object. The <code>h</code> helper method is provided by the projector instance and allows you to use Rails view helpers in your projector methods.</p>
<h2 id="controller-part">Controller part<a class="headerlink" href="#controller-part" title="Permanent link">&para;</a></h2>
<p>The primary role of a controller is to serve actions, but in order to automatically detect controller actions and dispatch requests to them, we need a small DSL. Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestProjector</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Projector</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="ss">:help</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># render a view that shows help</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="ss">:form</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># render a form. This is a default `get` action for this controller</span>
<span class="w">  </span><span class="k">end</span>

<span class="w">  </span><span class="n">post</span><span class="w"> </span><span class="ss">:perform</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># process the form. This is a default `post` action for this controller</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The first part of this code is the verb definition, which can be any REST verb. The second part is the mount point name to create a beautiful URL. You can set it using the <code>:as</code> option, and it's recommended to set it to an empty string so that the actual controller action isn't part of the URL.</p>
<p>For example, if you mounted the <code>BA::Company::Create</code> business action that had a projector with a <code>perform</code> controller action, the default path to the action would be <code>create/perform</code>. By adding <code>as: ''</code> to the <code>perform</code> action definition, you can change the path to <code>create</code>.</p>
<p>Note that the provided code defines methods called <code>help</code>, <code>form</code>, and <code>perform</code> in the <code>controller_class</code>. Also, keep in mind that calling <code>render</code> inside those blocks doesn't implicitly render the view within the application layout. To do so, you need to pass <code>layout: 'application'</code> to the <code>render</code> call.</p>
<h3 id="customizations">Customizations<a class="headerlink" href="#customizations" title="Permanent link">&para;</a></h3>
<p>The <code>Granite::Controller</code> is a subclass of <code>ActionController::Base</code> by default. However, it can be customized by changing the base_controller attribute in the Granite module's initializer. For example, to change the base controller to <code>ApplicationController</code>, you can do the following:</p>
<div class="highlight"><pre><span></span><code><span class="no">Granite</span><span class="o">.</span><span class="n">tap</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">m</span><span class="o">|</span>
<span class="w">  </span><span class="n">m</span><span class="o">.</span><span class="n">base_controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ApplicationController&#39;</span>
<span class="k">end</span>
</code></pre></div>
<p>In order to set the performer for Granite actions, you can implement the <code>projector_performer</code> method. For example, if you want to use the <code>current_user</code> method as the performer for all Granite actions, you can do the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">projector_performer</span>
<span class="w">  </span><span class="n">current_user</span>
<span class="k">end</span>
</code></pre></div>
<p>It's worth noting that <code>Granite::Controller</code> can be further customized after running the <code>rails generate granite:install_controller</code> command. The original controller will be installed in <code>app/controllers/granite/controller.rb</code>, which can be modified to fit your specific needs.</p>
<h3 id="handling-policy-exception">Handling policy exception<a class="headerlink" href="#handling-policy-exception" title="Permanent link">&para;</a></h3>
<p>When an action's policies are not satisfied, Granite raises a <code>Granite::Action::NotAllowedError</code> exception. To handle this exception in the <code>base_controller_class</code>, you can use the <code>rescue_from</code> method like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ApplicationController</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
<span class="w">  </span><span class="n">rescue_from</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Action</span><span class="o">::</span><span class="no">NotAllowedError</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">exception</span><span class="o">|</span>
<span class="w">    </span><span class="c1"># Handle the exception</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Inside the block, you can define how to handle the exception, for example by rendering an error page or redirecting the user to a different page.</p>
<h2 id="extending-projectors">Extending projectors<a class="headerlink" href="#extending-projectors" title="Permanent link">&para;</a></h2>
<p>To provide more flexibility in customizing projectors, Granite allows passing a block to the projector declaration when mounting to business actions. This block can be used to configure the projector or even extend its controller class.</p>
<p>Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Granite</span><span class="o">::</span><span class="no">Action</span>
<span class="w">  </span><span class="n">projector</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">controller_class</span><span class="o">.</span><span class="n">before_action</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">link_class</span>
<span class="w">      </span><span class="s1">&#39;super-link&#39;</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>In this example, the <code>before_action</code> hook is added to the controller class and a new method <code>link_class</code> is defined.  While using a block to modify projectors is useful for small changes, it's often preferable to derive a new projector from a standard one for more significant modifications.</p>
<h2 id="views">Views<a class="headerlink" href="#views" title="Permanent link">&para;</a></h2>
<p>Views for projectors are used in the same way as views for usual controllers but are stored and inherited differently. Basic views for projectors are stored in <code>apq/projectors/#{projector_name}</code> directory.</p>
<p>If you need to redefine a specific template for a particular action, you can do so by placing the template in <code>apq/actions/ba/#{action_name}/#{projector_name}</code> for <code>BA::ActionName.projector_name</code> projector.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2013 - 2018 Toptal
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>